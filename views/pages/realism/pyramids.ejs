<html lang="en"></html>
      <head>
        <meta charset="UTF-8">
        <title>Three JS</title>
        <%- include ('../../partials/head') %>
      </head>
    <body>
        <%- include ('../../partials/navbar') %>
        <div class="instructions">
            Sunset on Pyramids
        </div>
        <canvas id="sceneCanvas"></canvas>
    </body>
    <footer>
        <%- include ('../../partials/footer') %>
    </footer>
</html>

<script>
    let scene, camera, renderer, light, plane;
    let ADD = 0.005, theta = 0;
    //Pyramid creation (use of cylinder)
    let createPyramid = function(x, y, z, width, height) {
      // image courtesy of By ā€‹Japanese Wikipedia user Miya.m, CC BY-SA 3.0,
      //https://commons.wikimedia.org/w/index.php?curid=281620
      let texture = new THREE.TextureLoader().load('https://upload.wikimedia.org/wikipedia/commons/3/3b/Tuff_ohyaishi02.jpg');
      let geometry = new THREE.CylinderGeometry(0, width, height, 4);
      let material = new THREE.MeshLambertMaterial({map: texture});
      let p = new THREE.Mesh(geometry, material);
      p.position.set(x, y, z);
      p.castShadow = true;
      p.receiveShadow = true;
      return p;
    };

    //plane
    let createGeometry = function() {
      // Create the plane
      // Image courtousy to By Ji-Elle - Own work, CC BY-SA 3.0,
      // https://commons.wikimedia.org/w/index.php?curid=9429566
      let texture = new THREE.TextureLoader().load(
          'https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Adrar_sands.JPG/1280px-Adrar_sands.JPG'
      );
      let material = new THREE.MeshLambertMaterial({map: texture});
      let geometry = new THREE.BoxGeometry(1000, 1, 1000);
      plane = new THREE.Mesh(geometry, material);
      plane.position.y = -1;
      plane.receiveShadow = true;

      scene.add(plane);
      //Place pyramids (x, y, z, width, height)
      scene.add(createPyramid(0, 0, 0, 20, 25));
      scene.add(createPyramid(10, 0, -20, 30, 40));
      scene.add(createPyramid(30, 0, -30, 25, 35));
      scene.add(createPyramid(-15, 0, -15, 10, 10));
    };

    // set up the environment -
    // initiallize scene, camera, objects and renderer
    let init = function() {
      // create the scene
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xffffff);

      // create an locate the camera
      camera = new THREE.PerspectiveCamera(75,
                      window.innerWidth / window.innerHeight,
                      1, 1000);

      camera.position.set(0, 10, 40);

      //Create lights
      light = new THREE.DirectionalLight(0xffffff, 1);
      light.castShadow = true;
      light.shadow = new THREE.LightShadow( new
                  THREE.PerspectiveCamera(50, 1, 10, 2500));
      light.shadow.bias = 0.0001;
      light.shadow.mapSize.width = 2048;
      light.shadow.mapSize.height = 1024;
      light.position.set(10, 20, 0);

      scene.add(light);

      createGeometry();

      // create the renderer
      renderer = new THREE.WebGLRenderer( { canvas: sceneCanvas } );
      renderer.setSize(window.innerWidth, window.innerHeight-100);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFShadowMap;
    };

    // main animation loop - calls 50-60 times per second.
    let mainLoop = function() {
      light.position.x = 20 * Math.sin(theta);//move lights
      light.position.y = 20 * Math.cos(theta);
      theta += ADD;
      renderer.render(scene, camera);
      requestAnimationFrame(mainLoop);
    };

    ///////////////////////////////////////////////
    init();
    mainLoop();
</script>
